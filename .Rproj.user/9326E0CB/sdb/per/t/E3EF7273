{
    "contents" : "####DIAGNOSTICS####\n##Date: 04/03/2012\n\n##load packages\nlibrary(foreign)\n\n####SET UP####\n#set working directory\nsetwd('~/Google Drive/GOV_2001_REPLICATION/01_Data/REPLICATION_APSR_2014_BRQ/')\n\n#load data for tables 2 and 3\ntab2_3.dat <- read.dta('REPLICATION_TABLE_2_3_APSR_2014_BRQ.dta')\n\n#load data for sub-national afrobarometer analysis\ntab4.dat <- read.dta('REPLICATION_TABLE_4_APSR_2014_BRQ.dta')\n\n#load in grid-level data\ntab567.dat <- read.dta('REPLICATION_TABLE_5_6_7_APSR_2014_BRQ.dta')\n\n#create indicator variables if ever had historic conflict\ntab2_3.dat$everWar <- ifelse(tab2_3.dat$WarPrevalence14001700==0,0,1)\ntab4.dat$everWar <- ifelse(tab4.dat$WarPrevalence14001700==0,0,1)\n\n####CHECK FOR COMMON SUPPORT (CROSS-NATIONAL)####\n\n#ESTIMATE PROPENSITY SCORE FOR EXTENSIVE MARGIN\npscore.model.crossnat <- glm(everWar ~ f_french + f_pothco + f_belg + f_italy + f_germ + \n                      region_nNUNN + region_sNUNN + region_wNUNN + region_eNUNN,\n                    data=tab2_3.dat,\n                    family=binomial(link='logit'),\n                    na.action = na.exclude)\npscores.crossnat <- predict.glm(pscore.model.crossnat,type='response',na.action = na.exclude)\n#pscores.crossnat <- c(pscores[1:16],NA,pscores[17:48])#correct for missing data in Eritrea\ntab2_3.dat$pscores <- pscores.crossnat\n\n#PLOT DENSITY OF PROPENSITY SCORES BY TREATMENT\nlibrary(ggplot2)\npscore.plot.crossnat <- ggplot(data=tab2_3.dat,aes(x=pscores,group=factor(everWar),colour=factor(everWar)))+\n  geom_density(size=1.5)+\n  scale_color_discrete(guide = guide_legend(title='Ever Historical War'))+xlab('Propensity Scores')+\n  ggtitle('Distribution of Propensity Scores (Before Matching, Cross-National)')\npscore.plot.crossnat\n\n#Run KS test\nks.test(tab2_3.dat$pscores[tab2_3.dat$everWar==1],tab2_3.dat$pscores[tab2_3.dat$everWar==0])\n\n####CHECK FOR COMMON SUPPORT (SUB-NATIONAL)####\n\n#ESTIMATE PROPENSITY SCORE FOR EXTENSIVE MARGIN\npscore.model.subnat <- glm(everWar ~ age+age2+male+urban_dum+ln_export_pop+ln_pop_dens_1400+\n                             factor(education)+factor(occupation)+factor(religion)+factor(living_conditions),\n                             data=tab4.dat,\n                             family=binomial(link='logit'),\n                           na.action = na.exclude)\npscores.subnat <- predict.glm(pscore.model.subnat,type='response',na.action = na.exclude)\ntab4.dat$pscores <- pscores.subnat\n\n#PLOT DENSITY OF PROPENSITY SCORES BY TREATMENT\npscore.plot.subnat <- ggplot(data=tab4.dat,aes(x=pscores,group=factor(everWar),colour=factor(everWar)))+\n  geom_density(size=1.5)+\n  scale_color_discrete(guide = guide_legend(title='Ever Historical War'))+xlab('Propensity Scores')+\n  ggtitle('Distribution of Propensity Scores (Before Matching, Sub-National)')\npscore.plot.subnat\n\n#Run KS test\nks.test(tab4.dat$pscores[tab4.dat$everWar==1],tab4.dat$pscores[tab4.dat$everWar==0])\n\n\n####CHECK FOR COMMON SUPPORT (GRID-LEVEL)####\n\n#ESTIMATE PROPENSITY SCORE FOR EXTENSIVE MARGIN\npscore.model.grid <- glm(HistoricalConflictGrid ~ d1 + elev_srtm_pred + rough + tempav_8008 + \n                           precsdnew_80_08 + area + lpopdens90 + gridcity1400 + zulu_king + merina + monomotapa + \n                           lozi + malawi + kilwa + lunda + congo + luba + rwanda + buganda + ashanti + yoruba + \n                           ethiopia + axum + wolof + ghana + mali + kush + songhay + kanem_born + clas_egypt + \n                           carthage + factor(country),\n                           data=tab567.dat,\n                           family=binomial(link='logit'),\n                           na.action = na.exclude)\npscores.grid <- predict.glm(pscore.model.grid,type='response',na.action = na.exclude)\ntab567.dat$pscores <- pscores.grid\n\n#PLOT DENSITY OF PROPENSITY SCORES BY TREATMENT\npscore.plot.grid <- ggplot(data=tab567.dat,aes(x=pscores,group=factor(HistoricalConflictGrid),colour=factor(HistoricalConflictGrid)))+\n  geom_density(size=1.5)+\n  scale_color_discrete(guide = guide_legend(title='Historical Conflict in Grid'))+xlab('Propensity Scores')+\n  ggtitle('Distribution of Propensity Scores (Before Matching, Grid-Level)')\npscore.plot.grid\n\n#Run KS test\nks.test(tab567.dat$pscores[tab567.dat$HistoricalConflictGrid==1],\n        tab567.dat$pscores[tab567.dat$HistoricalConflictGrid==0])\n",
    "created" : 1459708538086.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2058200161",
    "id" : "E3EF7273",
    "lastKnownWriteTime" : 1459800876,
    "path" : "~/Google Drive/GOV_2001_REPLICATION/02_Analysis/Extended_Analysis/Diagnostics/diagnostics.R",
    "project_path" : "02_Analysis/Extended_Analysis/Diagnostics/diagnostics.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}